<div class="rhythm-container">
  <!-- èœå•ç•Œé¢ -->
  <div class="menu-overlay" *ngIf="gameData.state === rhythmState.MENU">
    <div class="menu-content">
      <h1>ğŸµ éŸ³ä¹èŠ‚å¥æ¸¸æˆ ğŸµ</h1>
      <p class="story-text">æ ¹æ®èŠ‚æ‹æŒ‰ä¸‹å¯¹åº”æŒ‰é”®ï¼<br/>å±•ç°ä½ çš„éŸ³ä¹å¤©èµ‹å§ï¼</p>
      
      <div class="level-selector" *ngIf="gameData.currentLevel">
        <h3>é€‰æ‹©å…³å¡</h3>
        <ion-button 
          *ngFor="let level of levels" 
          expand="block"
          [class.selected]="gameData.currentLevel?.id === level.id"
          (click)="selectLevel(level.id)">
          {{ level.name }} ({{ level.bpm }} BPM)
        </ion-button>
      </div>
      
      <ion-button expand="block" (click)="startGame()" *ngIf="gameData.currentLevel">
        å¼€å§‹æ¸¸æˆ
      </ion-button>
      
      <ion-button expand="block" fill="outline" (click)="goHome()" style="margin-top: 1rem;">
        è¿”å›ä¸»é¡µ
      </ion-button>
    </div>
  </div>

  <!-- æ¸¸æˆç•Œé¢ -->
  <div class="game-screen" *ngIf="gameData.state === rhythmState.PLAYING || gameData.state === rhythmState.PAUSED">
    <!-- æ¸¸æˆä¿¡æ¯ -->
    <div class="game-info">
      <div class="info-row">
        <div class="left-info">
          <div class="score">åˆ†æ•°: {{ Math.floor(gameData.score) }}</div>
          <div class="combo" *ngIf="gameData.combo > 0">è¿å‡»: {{ gameData.combo }}</div>
          <div class="accuracy" [style.color]="getAccuracyColor()">
            å‡†ç¡®åº¦: {{ gameData.accuracy.toFixed(1) }}%
          </div>
        </div>
        <div class="right-info">
          <button 
            class="pause-button"
            (click)="togglePause()"
            *ngIf="gameData.state === rhythmState.PLAYING || gameData.state === rhythmState.PAUSED">
            <span *ngIf="gameData.state === rhythmState.PLAYING">â¸ï¸</span>
            <span *ngIf="gameData.state === rhythmState.PAUSED">â–¶ï¸</span>
          </button>
          <div class="timer">
            â±ï¸ {{ formatTime(gameData.currentTime) }}
          </div>
        </div>
      </div>
      <div class="time-progress">
        <div class="progress-bar">
          <div class="progress-fill" 
               [style.width.%]="gameData.currentLevel ? (gameData.currentTime / gameData.currentLevel.duration * 100) : 0">
          </div>
        </div>
      </div>
    </div>

    <!-- éŸ³ç¬¦ä¸‹è½åŒºåŸŸ -->
    <div class="notes-area">
      <div class="key-lane" *ngFor="let key of keyConfig.keys">
        <div class="lane" [style.background-color]="getKeyColor(key) + '20'">
          <!-- åˆ¤å®šçº¿ -->
          <div class="hit-line" [style.background-color]="getKeyColor(key)"></div>
          
          <!-- ä¸‹è½çš„éŸ³ç¬¦ -->
          <div 
            *ngFor="let note of getNotesForKey(key)"
            class="note"
            [ngStyle]="getNoteStyle(note)"
            [class.hit]="note.hit"
            [class.perfect]="note.accuracy === 'perfect'"
            [class.great]="note.accuracy === 'great'"
            [class.good]="note.accuracy === 'good'">
            <span class="note-key">{{ note.key }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- æŒ‰é”®æç¤º -->
    <div class="keys-container">
      <div 
        *ngFor="let key of keyConfig.keys" 
        class="key-button"
        [ngClass]="'key-' + key.toLowerCase()"
        [style.background-color]="getKeyColor(key)"
        [style.border-color]="getKeyColor(key)">
        <span>{{ key }}</span>
      </div>
    </div>

    <!-- æš‚åœæç¤º -->
    <div class="pause-overlay" *ngIf="gameData.state === rhythmState.PAUSED">
      <div class="pause-content">
        <h2>æš‚åœ</h2>
        <ion-button expand="block" (click)="resumeGame()">ç»§ç»­æ¸¸æˆ</ion-button>
      </div>
    </div>
  </div>

  <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
  <div class="menu-overlay" *ngIf="gameData.state === rhythmState.FINISHED">
    <div class="menu-content">
      <h1>ğŸ‰ æ¸¸æˆç»“æŸï¼</h1>
      
      <div class="result-stats">
        <div class="stat-item">
          <div class="stat-label">æ€»åˆ†</div>
          <div class="stat-value">{{ Math.floor(gameData.score) }}</div>
        </div>
        
        <div class="stat-item">
          <div class="stat-label">è¯„çº§</div>
          <div class="stat-value rank-{{ getRank().toLowerCase() }}">{{ getRank() }}</div>
          <div class="stat-sub">{{ getRankName() }}</div>
        </div>
        
        <div class="stat-item">
          <div class="stat-label">å‡†ç¡®åº¦</div>
          <div class="stat-value" [style.color]="getAccuracyColor()">
            {{ gameData.accuracy.toFixed(1) }}%
          </div>
        </div>
        
        <div class="stat-item">
          <div class="stat-label">æœ€é«˜è¿å‡»</div>
          <div class="stat-value">{{ gameData.maxCombo }}</div>
        </div>
      </div>

      <div class="accuracy-breakdown">
        <h3>è¯¦ç»†ç»Ÿè®¡</h3>
        <div class="breakdown-item">
          <span class="breakdown-label perfect">Perfect</span>
          <span class="breakdown-value">{{ gameData.stats.perfect }}</span>
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label great">Great</span>
          <span class="breakdown-value">{{ gameData.stats.great }}</span>
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label good">Good</span>
          <span class="breakdown-value">{{ gameData.stats.good }}</span>
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label miss">Miss</span>
          <span class="breakdown-value">{{ gameData.stats.miss }}</span>
        </div>
        <div class="breakdown-total">
          æ€»è®¡: {{ getTotalNotes() }} ä¸ªéŸ³ç¬¦
        </div>
      </div>

      <ion-button expand="block" (click)="restartGame()">å†ç©ä¸€æ¬¡</ion-button>
      <ion-button expand="block" fill="outline" (click)="selectLevel(gameData.currentLevel?.id || 1)">
        é€‰æ‹©å…³å¡
      </ion-button>
      <ion-button expand="block" fill="outline" (click)="goHome()" style="margin-top: 1rem;">
        è¿”å›ä¸»é¡µ
      </ion-button>
    </div>
  </div>
</div>

